{
  "meta": {
    "document_type": "project_kickoff_conversation",
    "version": "1.0.0",
    "created_at": "2025-11-18T00:00:00Z",
    "language": "zh-CN"
  },
  "participants": [
    { "role": "user", "name": "You" },
    { "role": "assistant", "name": "AI Pair Programmer" }
  ],
  "context": {
    "existing_repo": "/Users/haoxiang/Downloads/EDA-CLINICAL-Projects/MeetingNotes",
    "trello": { "board_name": "Zcash Me", "meeting_list_name": "Meeting Notes" },
    "github": { "owner": "ZcashUsersGroup", "repo": "zcashme", "branch": "main" },
    "prompt_file": "prompts/summary_system_prompt.md",
    "current_server": { "command": "python webapp.py", "url": "http://127.0.0.1:8000/" }
  },
  "conversation": [
    {
      "speaker": "user",
      "message": "目前有\u201ctranscriptor\u201d应用（输入 Transcript、输出 Trello Card）。我的新计划：Phase 1 支持拖拽处理，输入一周的 Transcripts（Monday-Sunday，来自 Zcash Me Board 的 Meeting Notes 列），同时拉取一周的 GitHub Commits（ZcashUsersGroup/zcashme）与一周的 Trello Activity（Trello API）。使用 OpenAI+Prompt 进行转换（WDWDLW 模板），并将 Prompt 发布到 GitHub，输出完整模板。Phase 1 要发布在 GitHub Pages 做前端拖拽；Phase 2 要有 GET/POST 前端也发布在 GitHub Pages。请指导哪些文件可保留，数据如何通过 API 查找到。"
    },
    {
      "speaker": "assistant",
      "message": "建议保留：prompts/summary_system_prompt.md（作为系统提示）、.github/workflows/deploy-pages.yml（可拷贝用于新项目）、web/index.html 与 web/config.js（最小静态结构）、meeting_notes/trello_client.py（仅作字段参考，不直接用 Python）。新独立项目前端结构：index.html、assets/、src/（dragdrop.js、github.js、trello.js、openai.js、template.js、app.js）、prompts/summary_system_prompt.md、.github/workflows/pages.yml。数据来源：GitHub REST 拉取一周 main 的 commits；Trello 拉取 Zcash Me 下 Meeting Notes 列表卡片的 desc/评论/附件或整个 Board 的 actions。Phase 1：拖拽解析 .txt/.md/.docx（docx 用 mammoth.js），拉取 GitHub/Trello，调用 OpenAI 生成 WDWDLW，展示并下载 Markdown，发布到 GitHub Pages。Phase 2：后端/Actions 封装 GET/POST，隐藏密钥，支持一键生成/回写到仓库。安全：GitHub 可匿名但速率受限；Trello 和 OpenAI 需密钥，建议后端保管。"
    },
    {
      "speaker": "user",
      "message": "两个阶段迭代需要多久？是否可以从 GitHub 导出完整的一周 commits？是否可以从 Trello board 导出一周 transcript？"
    },
    {
      "speaker": "assistant",
      "message": "时间：Phase 1（拖拽+直连 API+Pages）约 1–2 天；Phase 2（后端/Actions GET/POST）约 2–4 天。GitHub 一周 commits 可行：GET /repos/ZcashUsersGroup/zcashme/commits?sha=main&since=&until=&per_page=100&page=1（带 token 提升配额）。若需全分支需枚举 branches 并合并去重。Trello 一周 transcript 可行：定位 Board→List（Meeting Notes）→Cards（fields=name,desc,dateLastActivity,shortUrl），拉取评论（/cards/{id}/actions?filter=commentCard）与附件（/cards/{id}/attachments），按周内时间过滤并合并成文本。"
    },
    {
      "speaker": "user",
      "message": "Trello board 名称是 Zcash Me，Meeting Notes 列表名就是 Meeting Notes。以 main 为准。WDWDLW 是什么？"
    },
    {
      "speaker": "assistant",
      "message": "WDWDLW 是\u201cWhat Did We Do Last Week\u201d（我们上周做了什么）的周报模板。建议结构：Week Range、Overview、Daily Log（What/Did/Decisions/Blockers/Learnings）、Cross-Week（Deliverables/Risks/Next Week Plan）、References（commit/Trello 链接）。数据映射：Trello Meeting Notes 的卡片 desc/评论/附件；GitHub zcashme 仓库 main 的一周提交。执行提示：将 {week, transcripts[], githubCommits[], trelloActions[]} 作为用户输入，结合系统提示 prompts/summary_system_prompt.md 生成 Markdown。"
    },
    {
      "speaker": "user",
      "message": "请将以上对话生成一封完整的、machine readable 的记录，我要新建一个项目来执行。"
    }
  ],
  "requirements": {
    "goal": "构建一个独立的周报生成前端，支持拖拽一周 transcripts，聚合 GitHub 和 Trello 一周活动，调用 OpenAI 生成 WDWDLW Markdown，并发布在 GitHub Pages；后续通过安全的 GET/POST 接口（后端或 Actions）隐藏密钥并支持回写到仓库。",
    "phases": [
      {
        "name": "Phase 1",
        "deliverables": [
          "拖拽上传与解析 .txt/.md/.docx，合并为按天的 transcripts",
          "拉取 GitHub main 分支一周 commits（带链接与作者日期）",
          "拉取 Trello Meeting Notes 列表相关卡片、评论与附件并按周内过滤",
          "OpenAI 生成 WDWDLW Markdown，页面展示与下载",
          "发布到 GitHub Pages 并提供公开链接"
        ],
        "non_goals": [
          "不实现后端密钥存储（可临时在前端输入 token）",
          "不做自动回写仓库（可选）"
        ]
      },
      {
        "name": "Phase 2",
        "deliverables": [
          "提供安全的 GET/POST API 封装 GitHub、Trello、OpenAI",
          "前端改为调用自有 API（隐藏密钥）",
          "可选：GitHub Actions 定时抓取周数据并产出静态 JSON",
          "可选：自动提交周报 Markdown 到指定仓库"
        ],
        "non_goals": [
          "不做复杂权限模型，仅使用仓库/平台密钥与最小化权限"
        ]
      }
    ],
    "timeline_estimate_days": { "phase1": "1-2", "phase2": "2-4" },
    "acceptance_criteria": [
      "Phase 1：在 GitHub Pages 上，用户可选择周范围、拖拽多文件、成功拉取 GitHub/Trello 数据、生成并下载 WDWDLW Markdown",
      "Phase 2：前端仅调用自有 API，不暴露密钥；能通过 POST 一键生成并（可选）回写到 GitHub 仓库"
    ]
  },
  "data_sources": {
    "github": {
      "repo": "ZcashUsersGroup/zcashme",
      "branch": "main",
      "commits_endpoint_template": "https://api.github.com/repos/ZcashUsersGroup/zcashme/commits?sha=main&since={ISO8601_START}&until={ISO8601_END}&per_page=100&page={PAGE}",
      "fields": ["sha", "html_url", "commit.message", "commit.author.date", "author.login"],
      "notes": [
        "匿名访问速率限制 60 次/小时；使用 Authorization: Bearer <token> 可提升到 5000 次/小时",
        "若需包含非 main 的提交，需枚举所有分支后合并去重（本项目以 main 为准）"
      ]
    },
    "trello": {
      "board_name": "Zcash Me",
      "meeting_list_name": "Meeting Notes",
      "auth": { "key": "<TRELLO_KEY>", "token": "<TRELLO_TOKEN>" },
      "endpoints": {
        "boards_of_me": "GET https://api.trello.com/1/members/me/boards?key=<key>&token=<token>",
        "lists_of_board": "GET https://api.trello.com/1/boards/{boardId}/lists?key=<key>&token=<token>",
        "cards_of_list": "GET https://api.trello.com/1/lists/{listId}/cards?key=<key>&token=<token>&fields=name,desc,dateLastActivity,shortUrl",
        "card_comments": "GET https://api.trello.com/1/cards/{cardId}/actions?key=<key>&token=<token>&filter=commentCard&limit=1000&since={ISO}&before={ISO}",
        "card_attachments": "GET https://api.trello.com/1/cards/{cardId}/attachments?key=<key>&token=<token>",
        "board_actions": "GET https://api.trello.com/1/boards/{boardId}/actions?key=<key>&token=<token>&filter=commentCard,updateCard,createCard,moveCard&limit=1000&since={ISO}&before={ISO}"
      },
      "notes": [
        "transcript 可来自卡片 desc、评论文本（action.data.text）或附件",
        "按周边界（Monday 00:00 — Next Monday 00:00）过滤 dateLastActivity 与 action.date"
      ]
    }
  },
  "processing": {
    "drag_and_drop": {
      "supported_types": [".txt", ".md", ".docx"],
      "docx_client_parser": "mammoth.js（浏览器端）",
      "bucketing": "按文件名或文内日期推断分配至 Monday–Sunday"
    },
    "grouping": {
      "github_commits": "按 commit.author.date 分桶至各天",
      "trello_items": "按卡片 dateLastActivity、评论 action.date 分桶至各天",
      "transcripts": "按推断日期/文件名分桶至各天"
    },
    "prompting": {
      "system_prompt_path": "prompts/summary_system_prompt.md",
      "model": "gpt-4o-mini",
      "temperature": 0.2,
      "input_object_schema": "{ week:{ startDate, endDate }, transcripts:[], github:[], trello:[] }",
      "output_format": "Markdown（WDWDLW 模板）"
    }
  },
  "wdwdlw_template": {
    "title": "Zcash Me Weekly Digest (YYYY-MM-DD — YYYY-MM-DD)",
    "sections": [
      "Overview",
      "Daily Log: Monday–Sunday（What / Did / Decisions / Blockers / Learnings）",
      "Deliverables（本周交付与链接）",
      "Risks/Blockers（未解决的阻碍）",
      "Next Week Plan（任务与负责人）",
      "References（GitHub/Trello/文档链接）"
    ]
  },
  "security": {
    "tokens": [
      "GitHub Token（提升速率与写入仓库）",
      "Trello Key/Token（必需）",
      "OpenAI API Key（建议仅在后端使用）"
    ],
    "recommendation": "Phase 2 采用后端/Actions 隐藏密钥；Phase 1 前端临时输入密钥需告知风险"
  },
  "deliverables": {
    "phase1": [
      "GitHub Pages 公开链接",
      "前端页面：拖拽、时间选择、生成并下载 WDWDLW Markdown",
      "文档：如何获取周数据与密钥输入说明"
    ],
    "phase2": [
      "API 文档（GET/POST 端点）",
      "部署说明（Workers/Vercel/Netlify 或 GitHub Actions）",
      "（可选）自动提交周报到目标仓库"
    ]
  },
  "files_to_keep_from_existing_repo": [
    "prompts/summary_system_prompt.md",
    ".github/workflows/deploy-pages.yml（作为参考模板）",
    "web/index.html 与 web/config.js（可作为最小静态结构参考）",
    "meeting_notes/trello_client.py（仅参考字段与数据结构）"
  ],
  "proposed_new_project_structure": {
    "root": "weekly-digest/",
    "files": [
      "index.html",
      "assets/styles.css",
      "src/app.js",
      "src/dragdrop.js",
      "src/github.js",
      "src/trello.js",
      "src/openai.js",
      "src/template.js",
      "prompts/summary_system_prompt.md",
      ".github/workflows/pages.yml",
      "README.md"
    ]
  },
  "api_examples": {
    "github_commits": "GET https://api.github.com/repos/ZcashUsersGroup/zcashme/commits?sha=main&since=2025-11-10T00:00:00Z&until=2025-11-17T00:00:00Z&per_page=100",
    "trello_cards": "GET https://api.trello.com/1/lists/{listId}/cards?key=<key>&token=<token>&fields=name,desc,dateLastActivity,shortUrl",
    "trello_comments": "GET https://api.trello.com/1/cards/{cardId}/actions?key=<key>&token=<token>&filter=commentCard&limit=1000&since=2025-11-10T00:00:00Z&before=2025-11-17T00:00:00Z",
    "openai_chat": "POST https://api.openai.com/v1/chat/completions"
  },
  "deployment": {
    "phase1_pages": "Settings > Pages > Deploy from branch > main / root",
    "output_link_example": "https://<your-username>.github.io/weekly-digest/",
    "phase2_options": [
      "Cloudflare Workers / Vercel Functions / Netlify Functions（封装 API）",
      "GitHub Actions 定时任务产出 data/week-YYYY-W.json 与 digests/week-YYYY-W.md"
    ]
  },
  "open_questions": [
    "时区选择（默认 UTC，还是你常用时区？）",
    "Phase 1 是否允许前端临时输入 Trello/GitHub/OpenAI 密钥？",
    "周报是否需要自动回写到指定仓库？回写路径与命名规则？",
    "是否需要支持从附件的 .docx/.pdf 自动抽取并做清洗？"
  ],
  "next_steps": [
    "新建独立仓库 weekly-digest 并启用 GitHub Pages",
    "在 README 中列出密钥配置方式（临时前端输入 vs 后端/Actions）",
    "实现最小可用：拖拽解析 + GitHub/Trello 拉取 + OpenAI 生成 + 下载",
    "确定时区与数据边界（Monday–Sunday），编写单元测试覆盖日期桶分配",
    "Phase 2 选择后端或 Actions；准备 API 路由与 Secrets"
  ]
}